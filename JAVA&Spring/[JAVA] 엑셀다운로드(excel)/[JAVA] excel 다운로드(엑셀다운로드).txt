# 사용한 라이브러리

apache\poi\poi-scratchpad\3.10-FINAL\poi-scratchpad-3.10-FINAL.jar

apache\poi\poi\3.10-FINAL\poi-3.10-FINAL.jar

apache\poi\poi-contrib\3.7-beta3\poi-contrib-3.7-beta3.jar


1. 화면단에 엑셀 다운로드 버튼 생성



2. 버튼클릭시 호출되는 function 생성 (ajax)



3. ajax 호출시 엑셀다운로드를 위해 생성한 컨트롤러 호출

	

	3-1. 컨트롤러에 넘기는값은 리스트를 조회할때 넘기는 값과 똑같아야 함





4. 해당 컨트롤러에서 화면에 뿌려주는거와 똑같이 서비스에서 리스트를 호출 



5. 호출된 리스트가 VO타입이라면 hashMap 타입으로 변경

	※ BeanUtils.describe 메소드를 사용하여서 VO 를 Hashmap 으로 변경할 수 있음



		//vo를 맵으로 변경

		for(int i=0;i<gongmunList.size();i++) {

			list.add((HashMap<String, String>) BeanUtils.describe(gongmunList.get(i)));

			System.out.println(list.get(i));

		}



		

		vo = userName

		getUserName(

		map.get("userName")

6.엑셀 다운로드 메소드를 호출함

	//파일 작성 후 파일 경로와 파일명을 리턴하여 해당 경로에서 파일을 다운받을 수 있도록 함

	/*	

	 * @Param

	 * List<HashMap<String, String>> mapList : 엑셀에 찍을 데이터

	 * keyArray[] : 맵에서 꺼낼 키값

	 * listTitle[] : 엑셀에 표시할 분류 이름

	 * Path : 저장 경로 

	 * subPath : 저장경로의 하위 폴더 경로 

	 * title : 엑셀파일 상단의 제목, 파일명

	 * 

	 * @Return

	 * String path[]

	 * 0 : 전체경로

	 * 1 : 서브경로

	 * */



7. 리턴받은 배열의 2번쟤 [1] 를 ajax에서 윈도우로케이션으로 호출.



	public String[] excelDownload(List<HashMap<String, String>> mapList , String[] keyArray,String listTitle[], String Path , String subPath , String title) throws Exception



	



# ajax 

	호출URL만 변경, 

	function fn_excelDown(){



		$.actionInvoke(

			"POST"

			, true

			, get_invoke()+"/HrmsGongmunseo/excelDownload.json"

			, {"flag" : 1}

			, function(resultData){



				 window.location =resultData[1];

			}

		);

			 

	}





# 컨트롤러



	/**

	 * @see 발령공문 다운로드 

	 * @param ReqGongmunseoVO

	 * @return List<ReqGongmunseoVO>

	 * @throws Exception

	 */

	@RequestMapping(method = RequestMethod.POST, value = "/excelDownload.json", produces = MediaType.APPLICATION_JSON_VALUE)

	public @ResponseBody String[] excelDownload (@RequestBody ReqGongmunseoVO reqGongmunseoVO , HttpServletRequest request, HttpServletResponse response) throws Exception{



		HttpSession session = request.getSession();

		

		List<HashMap<String, String>> list = new ArrayList<>();

		List<ReqGongmunseoVO> gongmunList= gongmunseoService.getGongmunData(reqGongmunseoVO);

		

		

		

		//vo를 맵으로 변경

		for(int i=0;i<gongmunList.size();i++) {

			list.add((HashMap<String, String>) BeanUtils.describe(gongmunList.get(i)));

			System.out.println(list.get(i));

		}

		

		ExcelDownloadUtil excelUtil = new ExcelDownloadUtil();

		String listTitle[] = {"연변" , "발령사항", "계급" , "성명" , "현소속"};

		String keyArray[] = {"seq" , "hnGwanseoNm","hnJikgeupNm","empNm","beforeGwanseoNm"};

		String subPath="resources\\upload\\excel\\";

		String path=session.getServletContext().getRealPath("/");

		String fileName = "발령공문";



		String filePath[] = excelUtil.excelDownload( list, keyArray, listTitle , session.getServletContext().getRealPath("/") , subPath,fileName);



		

		return filePath;



	}